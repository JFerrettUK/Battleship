(()=>{"use strict";function t(){let t=[];for(let e=0;e<10;e++){let e=[];for(let t=0;t<10;t++)e.push(null);t.push(e)}let e={},n=[],i=[],r=[],o=function(e,n,i){t[e][n]=i},s=function(t){e[t].hit()},a=function(t,e){n.push([t,e])},l=function(t,e){i.push([t,e])},u=function(t,e){r.push([t,e])},c=function(){if(n.length>=99)return["board full",[e,i]];let e=Math.floor(10*Math.random()),i=Math.floor(10*Math.random());if("missed"==t[e][i]||"hitShip"==t[e][i])return c();if(null==t[e][i])o(e,i,"missed"),a(e,i),l(e,i);else{let n=t[e][i].toString();s(n),o(e,i,"hitShip"),l(e,i)}return["hitBefore",[e,i]]};return{board:t,ships:e,listMissed:n,isMissed:function(t,e){return!!n.some((function(n){return n[0]===t&&n[1]===e}))},placeShip:function(n,i,r,s){if(function(t){e[`ship${t}`]=function(t){return function(t){return{length:t,hits:0,hit:function(){this.hits+=1},isSunk:function(){return this.hits>=this.length}}}(t)}(t)}(n),i>9||r>9)return"offBoard";if("vertical"===s.toLowerCase()){for(let e=i;e<n+i;e++)if(e>9||null!==t[e][r])return"occupiedSquare";for(let t=i;t<n+i;t++)o(t,r,`ship${n}`)}else{for(let e=r;e<n+r;e++)if(e>9||null!==t[i][e])return"occupiedSquare";for(let t=r;t<n+r;t++)o(i,t,`ship${n}`)}},receiveAttack:function(e,n){if(null==t[e][n])o(e,n,"missed"),a(e,n),l(e,n);else{if("missed"==t[e][n])return"hitBefore";if("hitShip"==t[e][n])return"hitBefore";{let i=t[e][n].toString();s(i),o(e,n,"hitShip"),u(e,n),l(e,n)}}},receiveAIAttack:function(e,i){if(n.length>=99)return["board full",[e,i]];if(null==t[e][i])o(e,i,"missed"),a(e,i),l(e,i);else{if("missed"==t[e][i])return"missed";if("hitShip"==t[e][i])return"hitBefore";{let n=t[e][i].toString();s(n),o(e,i,"hitShip"),l(e,i),u(e,i)}}},receiveRandomAIAttack:c,allSunk:function(){for(let t in e)if(1!=e[t].isSunk())return!1;return!0},anyMissed:function(){for(let e=0;e<10;e++)for(let n=0;n<10;n++)if("missed"===t[e][n])return[!0,[e,n]];return[!1,[]]},anyAttacks:function(){for(let e=0;e<10;e++)for(let n=0;n<10;n++)if("missed"===t[e][n]||"hitShip"===t[e][n])return[!0,[e,n]];return[!1,[]]},missedInARow:function(e){for(let n=0;n<10;n++)if("missed"===t[e][n])return[!0,[e,n]];return!1},saveAttacked:l,isHit:function(t,e){return!!r.some((function(n){return n[0]===t&&n[1]===e}))},isAttacked:function(t,e){return!!i.some((function(n){return n[0]===t&&n[1]===e}))},listAttacked:i,generatePotentialTargets:function(){const t=[];for(let e=0;e<10;e++)for(let n=0;n<10;n++)this.isAttacked(e,n)||t.push([e,n]);return t},listHit:r}}function e(t,e,n){let i;i="user"==n?document.getElementById(t+"-"+e+"-userBoard"):document.getElementById(t+"-"+e+"-aiBoard"),(i.classList.contains("blue")||i.classList.contains("cyan"))&&(i.classList.remove("blue"),i.classList.remove("cyan")),i.classList.contains("grey")&&i.classList.remove("grey"),"user"==n?i.classList.add("shipSquare"):i.classList.add("aiShipSquare")}function n(t,n,i,r){if(n>9||i>9)return"offBoard";if("vertical"===r){for(let e=n;e<t+n;e++){if(e>9)return"offBoard";if(document.getElementById(e+"-"+i+"-userBoard").classList.contains("shipSquare"))return"occupiedSquare"}for(let r=n;r<t+n;r++)e(r,i,"user")}else{for(let e=i;e<t+i;e++){if(e>9)return"offBoard";if(document.getElementById(n+"-"+e+"-userBoard").classList.contains("shipSquare"))return"occupiedSquare"}for(let r=i;r<t+i;r++)e(n,r,"user")}}function i(t,n,i,r){if(document.querySelectorAll(".aiShipSquare").forEach((t=>{t.classList.remove("shipSquare")})),n>9||i>9)return"offBoard";if("vertical"===r){for(let e=n;e<t+n;e++){if(e>9)return"offBoard";if(document.getElementById(e+"-"+i+"-aiBoard").classList.contains("aiShipSquare"))return"occupiedSquare"}for(let r=n;r<t+n;r++)e(r,i,"ai")}else{for(let e=i;e<t+i;e++){if(e>9)return"offBoard";if(document.getElementById(n+"-"+e+"-aiBoard").classList.contains("aiShipSquare"))return"occupiedSquare"}for(let r=i;r<t+i;r++)e(n,r,"ai")}}function r(t,e){const n=[];return e>0&&n.push([t,e-1]),e<9&&n.push([t,e+1]),t>0&&n.push([t-1,e]),t<9&&n.push([t+1,e]),n}function o(t){const e=document.getElementsByClassName("announceCont")[0],n=e.querySelector("#announceText"),i=e.querySelector(".buttonContainer"),r=i.querySelector("button"),o=document.querySelector("#boardContainers");n.innerHTML="",o.innerHTML="","user"===t?(n.textContent="You win! Congratulations. Click below to play again.",o.innerHTML=""):"ai"===t&&(n.textContent="You lose! Better luck next time..."),e.style.display="grid",i.style.display="flex",r.style.display="inline-block",r.classList.add("playButton"),r.addEventListener("click",(()=>{location.reload()}))}function s(t){!function(){const t=document.getElementById("aiTitle"),e=document.getElementById("aiBoard");t.style.display="none",e.style.display="none"}(),function(){const t=document.getElementById("boardContainers");t.style.gridTemplateColumns="1fr 0.1fr",t.style.flexDirection="row"}(),function(){const t=document.getElementById("flipShips"),e=document.getElementById("verShips"),n=document.getElementById("horShips");t.addEventListener("click",(()=>{"none"===e.style.display?(e.style.display="grid",n.style.display="none"):(e.style.display="none",n.style.display="grid")}))}();let e=0,n=!1;!function(t){var e=document.getElementById("aiTitle"),n=document.getElementById("aiBoard");e.style.display="none",n.style.display="none";const i=document.querySelectorAll(".shipPiece"),r=document.querySelectorAll(".userSquare");let o=[],s=0,a=!1;const l={};let u,c;function d(t){u=t.target,c=u.dataset.orientation,t.dataTransfer.setData("text/plain","")}function f(){u&&u.parentNode&&(u.style.transform="none",u.style.position="absolute",u.style.left=l[u.id].left,u.style.top=l[u.id].top,u.dataset.orientation=l[u.id].orientation)}function p(t){t.preventDefault()}function h(e){e.preventDefault();const n=e.target.closest(".userSquare");if(n){const i=e.clientX-n.getBoundingClientRect().left,r=e.clientY-n.getBoundingClientRect().top,l=Math.min(parseInt(n.dataset.row,10),9),c=Math.min(parseInt(n.dataset.column,10),9),d=parseInt(u.getAttribute("alt"),10),f=u.dataset.orientation;let p,h;"vertical"===f?(p=Math.min(l+Math.floor(r/n.offsetHeight),9-d+1),h=c):(p=l,h=Math.min(c+Math.floor(i/n.offsetWidth),9-d+1));const m=[];for(let t=0;t<d;t++){let e,n;if("vertical"===f?(e=p+t,n=h):(e=p,n=h+t),e>9||n>9)return;m.push({row:e,column:n})}if(a=function(t){for(const e of t)for(const t of o)if(t.occupiedSquares.some((t=>t.row===e.row&&t.column===e.column)))return!1;return!0}(m),a){if("vertical"===f&&(u.style.transform="none",u.style.position="absolute",u.style.left=h*n.offsetWidth+"px",u.style.top=p*n.offsetHeight+"px"),o.push({size:d,orientation:f,occupiedSquares:m}),s++,u.parentElement){if(u.id.endsWith("V")){const t=document.getElementById(u.id.replace(/V$/,""));t&&t.parentElement&&t.parentElement.removeChild(t)}else{const t=document.getElementById(`${u.id}V`);t&&t.parentElement&&t.parentElement.removeChild(t)}u.parentElement.removeChild(u)}if(s<=4&&"function"==typeof t){const e=function(t){const e=[];for(let n=0;n<t.length;n++){const i=t[n],r=i.size,o=i.orientation,s=i.occupiedSquares;let a=1/0,l=1/0;for(let t=0;t<s.length;t++){const{row:e,column:n}=s[t];a=Math.min(a,e),l=Math.min(l,n)}e.push([r,a,l,o])}return e}(o);t(e,a)}}}}i.forEach((t=>{t.addEventListener("dragstart",d),t.addEventListener("dragend",f),l[t.id]={top:t.style.top,left:t.style.left,orientation:t.dataset.orientation}})),r.forEach((t=>{t.addEventListener("dragover",p),t.addEventListener("drop",h)}))}((function(i){e=i.length,e>3&&!n&&(n=!0,function(){const t=document.getElementById("boardContainers"),e=document.querySelector(".boardCont1"),n=document.getElementById("flipShips"),i=document.getElementById("horShips"),r=document.getElementById("verShips"),o=document.getElementById("aiTitle"),s=document.getElementById("aiBoard");o.style.display="flex",s.style.display="grid",t&&e&&(t.style.display="grid",t.style.justifyContent="center",t.style.gridTemplateColumns="1fr 1fr",t.style.top="52px",t.style.minWidth="800px",t.style.gridTemplateColumns="1fr 1fr",e.style.position="",e.style.marginTop="",n.style.display="none",i.style.display="none",r.style.display="none")}()),t(i)}))}!function(){let e=function(e){const n={name:"Hal",isTurn:!1,playerBoard:t()},i={name:e,isTurn:!0,playerBoard:t()},r=i.playerBoard.receiveRandomAIAttack.bind(i.playerBoard),o=i.playerBoard.receiveAIAttack.bind(i.playerBoard),s=n.playerBoard.receiveAttack.bind(n.playerBoard),a=function(){let t=0;return{whoseTurn:function(t,e){return 0==e.isTurn&&1==t.isTurn?"playerTurn":0==t.isTurn&&1==e.isTurn?"aiTurn":void 0},switchTurns:function(e,n){e.isTurn=!e.isTurn,n.isTurn=!n.isTurn,t+=1},getNo:function(){return t}}}(),l=n.playerBoard.placeShip.bind(n.playerBoard),u=i.playerBoard.placeShip.bind(i.playerBoard);return{ai:n,user:i,turns:a,attackPlayer:function(t,e){return"hitBefore"==o(t,e)?[[t,e],"hitBefore"]:(a.switchTurns(i,n),[t,e])},attackPlayerRandom:function(){let t=r()[1];return a.switchTurns(i,n),t},attackAI:function(t,e){return"hitBefore"==s(t,e)?[[t,e],"hitBefore"]:(a.switchTurns(i,n),[t,e])},placeAIShip:l,placeUserShip:u,placeGameShips:function(t){let e,n;t||(t={aiShips:[[2,2,1,"vertical"],[3,4,4,"horizontal"],[4,6,1,"horizontal"],[5,4,5,"vertical"]],playerShips:[[2,2,1,"vertical"],[3,4,3,"horizontal"],[4,6,1,"horizontal"],[5,4,5,"vertical"]]}),e=t.aiShips,n=t.playerShips,function(){for(let t=0;t<e.length;t++)l(...e[t]),u(...n[t])}()}}}("James");!function(t){function e(e,n){for(let i=0;i<10;i++){const r=document.createElement("div");r.classList.add("battleSquare"),r.classList.add("userSquare"),r.dataset.row=e.toString(),r.dataset.column=i.toString(),"blue"==n?i%2==0?r.classList.add("blue"):r.classList.add("cyan"):i%2==0?r.classList.add("cyan"):r.classList.add("blue"),r.classList.contains("shipSquare")&&r.classList.remove("shipSquare"),r.id=`${e}-${i}-${t}`,document.getElementById(t).appendChild(r)}}document.getElementById(t).innerHTML="",function(){for(let t=0;t<10;t++)e(t,"blue"),t++,e(t,"cyan")}()}("userBoard"),function(t){function e(e,n){for(let n=0;n<10;n++){const i=document.createElement("div");i.classList.add("battleSquare"),i.classList.add("aiSquare"),i.classList.add("grey"),i.dataset.row=e.toString(),i.dataset.column=n.toString(),i.classList.contains("aiShipSquare")&&i.classList.remove("aiShipSquare"),i.id=`${e}-${n}-${t}`,document.getElementById(t).appendChild(i)}}document.getElementById(t).innerHTML="",function(){for(let t=0;t<10;t++)e(t)}()}("aiBoard");let a=0;s((function(t){let r=function(){function t(t,e){return Math.floor(Math.random()*(e-t+1))+t}function e(e,n){const i=[];let r,o;"vertical"===n?(r=t(0,9-e+1),o=t(0,9)):(r=t(0,9),o=t(0,9-e+1));for(let t=0;t<e;t++)"vertical"===n?i.push({row:r+t,column:o}):i.push({row:r,column:o+t});return i}return function(){const t=[{length:2,alignment:"horizontal"},{length:3,alignment:"vertical"},{length:4,alignment:"horizontal"},{length:5,alignment:"vertical"}],n=[];for(const i of t){let t,r=!1;for(;!r;)t=e(i.length,i.alignment),r=n.every((e=>t.every((t=>!e.some((e=>e.row===t.row&&e.column===t.column))))));n.push([i.length,t[0].row,t[0].column,i.alignment])}return n}()}();const o={aiShips:r,playerShips:t};console.log(r),a++,console.log("runTime is"+a),function(t){let e;e=t.playerShips,function(){for(let t=0;t<e.length;t++)n(...e[t])}()}(o),a>=4&&(function(t){let e,r;e=t.aiShips,r=t.playerShips,function(){for(let t=0;t<e.length;t++)i(...e[t]),n(...r[t])}()}(o),e.placeGameShips(o),console.log(e.ai.playerBoard.board))})),function(t,e){document.querySelectorAll(".aiSquare").forEach((n=>{n.addEventListener("click",(()=>{const i=parseInt(n.dataset.row),o=parseInt(n.dataset.column);let s,a;n.classList.contains("aiShipSquare")?n.classList.add("hitShip"):(n.classList.add("missed"),i%2==0&&o%2==0||i%2!=0&&o%2!=0?n.classList.add("blue"):n.classList.add("cyan")),n.classList.add("flash"),setTimeout((()=>{n.classList.remove("flash")}),500);let l=[];const u=e.user.playerBoard.listHit,c=e.user.playerBoard.generatePotentialTargets();for(const t of u){const[n,i]=t,o=r(n,i);for(const t of o){const[n,i]=t;e.user.playerBoard.isAttacked(n,i)||l.push(t)}}let d;if(l.length>0){const t=l[0];d=[t[0],t[1]]}else d=c[Math.floor(Math.random()*c.length)];const f=10*d[0]+d[1];s=d[0],a=d[1];const p=document.querySelectorAll(".userSquare")[f];p.classList.contains("shipSquare")?p.classList.add("hitShip"):(p.classList.add("missed"),i%2==0&&o%2==0||i%2!=0&&o%2!=0?p.classList.add("blue"):p.classList.add("cyan")),p.classList.add("flash"),setTimeout((()=>{p.classList.remove("flash")}),500),t(i,o,s,a)}))}))}(((t,n,i,r)=>{e.attackAI(t,n),e.attackPlayer(i,r),e.user.playerBoard.allSunk()?o("ai"):e.ai.playerBoard.allSunk()&&o("user")}),e)}()})();