(()=>{"use strict";function t(){let t=[];for(let e=0;e<10;e++){let e=[];for(let t=0;t<10;t++)e.push(null);t.push(e)}let e={},n=[],r=[],a=[],s=function(e,n,i){t[e][n]=i},o=function(t){e[t].hit()},l=function(t,e){n.push([t,e])},u=function(t,e){r.push([t,e])},c=function(t,e){a.push([t,e])},d=function(){if(n.length>=99)return["board full",[e,i]];let e=Math.floor(10*Math.random()),i=Math.floor(10*Math.random());if("missed"==t[e][i]||"hitShip"==t[e][i])return d();if(null==t[e][i])s(e,i,"missed"),l(e,i),u(e,i);else{let n=t[e][i].toString();o(n),s(e,i,"hitShip"),u(e,i)}return["hitBefore",[e,i]]};return{board:t,ships:e,listMissed:n,isMissed:function(t,e){return!!n.some((function(n){return n[0]===t&&n[1]===e}))},placeShip:function(n,i,r,a){if(function(t){e[`ship${t}`]=function(t){return function(t){return{length:t,hits:0,hit:function(){this.hits+=1},isSunk:function(){return this.hits>=this.length}}}(t)}(t)}(n),i>9||r>9)return"offBoard";if("vertical"==a){for(let e=r;e<n+r;e++){if(e>9)return"offBoard";if(null!==t[i][e])return"occupiedSquare"}for(let t=r;t<n+r;t++)s(i,t,`ship${n}`)}else{for(let e=i;e<n+i;e++){if(e>9)return"offBoard";if(null!==t[e][r])return"occupiedSquare"}for(let t=i;t<n+i;t++)s(t,r,`ship${n}`)}},receiveAttack:function(e,n){if(null==t[e][n])s(e,n,"missed"),l(e,n),u(e,n);else{if("missed"==t[e][n])return"hitBefore";if("hitShip"==t[e][n])return"hitBefore";{let i=t[e][n].toString();o(i),s(e,n,"hitShip"),c(e,n),u(e,n)}}},receiveAIAttack:function(e,i){if(n.length>=99)return["board full",[e,i]];if(null==t[e][i])s(e,i,"missed"),l(e,i),u(e,i);else{if("missed"==t[e][i])return"missed";if("hitShip"==t[e][i])return"hitBefore";{let n=t[e][i].toString();o(n),s(e,i,"hitShip"),u(e,i),c(e,i)}}},receiveRandomAIAttack:d,allSunk:function(){for(let t in e)if(1!=e[t].isSunk())return!1;return!0},anyMissed:function(){for(let e=0;e<10;e++)for(let n=0;n<10;n++)if("missed"===t[e][n])return[!0,[e,n]];return[!1,[]]},anyAttacks:function(){for(let e=0;e<10;e++)for(let n=0;n<10;n++)if("missed"===t[e][n]||"hitShip"===t[e][n])return[!0,[e,n]];return[!1,[]]},missedInARow:function(e){for(let e=0;e<10;e++)for(let e=0;e<10;e++)if("missed"===t[i][e])return[!0,[i,e]];return!1},saveAttacked:u,isHit:function(t,e){return!!a.some((function(n){return n[0]===t&&n[1]===e}))},isAttacked:function(t,e){return!!r.some((function(n){return n[0]===t&&n[1]===e}))},listAttacked:r,generatePotentialTargets:function(){const t=[];for(let e=0;e<10;e++)for(let n=0;n<10;n++)this.isAttacked(e,n)||t.push([e,n]);return t},listHit:a}}function e(t,e){const n=[];return e>0&&n.push([t,e-1]),e<9&&n.push([t,e+1]),t>0&&n.push([t-1,e]),t<9&&n.push([t+1,e]),n}function n(t){const e=document.getElementsByClassName("announceCont")[0],n=e.querySelector("#announceText"),i=e.querySelector(".buttonContainer"),r=i.querySelector("button"),a=document.querySelector("#boardContainers");n.innerHTML="",a.innerHTML="","user"===t?(n.textContent="You win! Congratulations. Click below to play again.",a.innerHTML=""):"ai"===t&&(n.textContent="You lose! Better luck next time..."),e.style.display="grid",i.style.display="flex",r.style.display="inline-block",r.classList.add("playButton"),r.addEventListener("click",(()=>{location.reload()}))}!function(){let i=function(e){const n={name:"Hal",isTurn:!1,playerBoard:t()},i={name:e,isTurn:!0,playerBoard:t()},r=i.playerBoard.receiveRandomAIAttack.bind(i.playerBoard),a=i.playerBoard.receiveAIAttack.bind(i.playerBoard),s=n.playerBoard.receiveAttack.bind(n.playerBoard),o=function(){let t=0;return{whoseTurn:function(t,e){return 0==e.isTurn&&1==t.isTurn?"playerTurn":0==t.isTurn&&1==e.isTurn?"aiTurn":void 0},switchTurns:function(e,n){e.isTurn=!e.isTurn,n.isTurn=!n.isTurn,t+=1},getNo:function(){return t}}}(),l=n.playerBoard.placeShip.bind(n.playerBoard),u=i.playerBoard.placeShip.bind(i.playerBoard);return{ai:n,user:i,turns:o,attackPlayer:function(t,e){return"hitBefore"==a(t,e)?[[t,e],"hitBefore"]:(o.switchTurns(i,n),[t,e])},attackPlayerRandom:function(){let t=r()[1];return o.switchTurns(i,n),t},attackAI:function(t,e){return"hitBefore"==s(t,e)?[[t,e],"hitBefore"]:(o.switchTurns(i,n),[t,e])},placeAIShip:l,placeUserShip:u,placeGameShips:function(t){let e,n;t||(t={aiShips:[[2,2,1,"vertical"],[3,4,4,"horizontal"],[4,6,1,"horizontal"],[5,4,5,"vertical"]],playerShips:[[2,2,1,"vertical"],[3,4,3,"horizontal"],[4,6,1,"horizontal"],[5,4,5,"vertical"]]}),e=t.aiShips,n=t.playerShips,function(){for(let t=0;t<e.length;t++)l(...e[t]),u(...n[t])}()}}}("James");(function(t){function e(e,n){for(let i=0;i<10;i++){const r=document.createElement("div");r.classList.add("battleSquare"),r.classList.add("userSquare"),r.dataset.row=e.toString(),r.dataset.column=i.toString(),"blue"==n?i%2==0?r.classList.add("blue"):r.classList.add("cyan"):i%2==0?r.classList.add("cyan"):r.classList.add("blue"),r.classList.contains("shipSquare")&&r.classList.remove("shipSquare"),r.id=`${e}-${i}-${t}`,document.getElementById(t).appendChild(r)}}document.getElementById(t).innerHTML="",function(){for(let t=0;t<10;t++)e(t,"blue"),t++,e(t,"cyan")}()})("userBoard"),function(t){function e(e,n){for(let n=0;n<10;n++){const i=document.createElement("div");i.classList.add("battleSquare"),i.classList.add("aiSquare"),i.classList.add("grey"),i.dataset.row=e.toString(),i.dataset.column=n.toString(),i.classList.contains("aiShipSquare")&&i.classList.remove("aiShipSquare"),i.id=`${e}-${n}-${t}`,document.getElementById(t).appendChild(i)}}document.getElementById(t).innerHTML="",function(){for(let t=0;t<10;t++)e(t)}()}("aiBoard"),function(t,n){document.querySelectorAll(".aiSquare").forEach((i=>{i.addEventListener("click",(()=>{const r=parseInt(i.dataset.row),a=parseInt(i.dataset.column);let s,o;i.classList.contains("aiShipSquare")?i.classList.add("hitShip"):(i.classList.add("missed"),r%2==0&&a%2==0||r%2!=0&&a%2!=0?i.classList.add("blue"):i.classList.add("cyan")),i.classList.add("flash"),setTimeout((()=>{i.classList.remove("flash")}),500);let l=[];const u=n.user.playerBoard.listHit,c=n.user.playerBoard.generatePotentialTargets();for(const t of u){const[i,r]=t,a=e(i,r);for(const t of a){const[e,i]=t;n.user.playerBoard.isAttacked(e,i)||l.push(t)}}let d;if(l.length>0){const t=l[0];d=[t[0],t[1]]}else d=c[Math.floor(Math.random()*c.length)];const f=10*d[0]+d[1];s=d[0],o=d[1];const h=document.querySelectorAll(".userSquare")[f];h.classList.contains("shipSquare")?h.classList.add("hitShip"):(h.classList.add("missed"),r%2==0&&a%2==0||r%2!=0&&a%2!=0?h.classList.add("blue"):h.classList.add("cyan")),h.classList.add("flash"),setTimeout((()=>{h.classList.remove("flash")}),500),t(r,a,s,o)}))}))}(((t,e,r,a)=>{i.attackAI(t,e),i.attackPlayer(r,a),i.user.playerBoard.allSunk()?n("ai"):i.ai.playerBoard.allSunk()&&n("user")}),i)}(),function(){const t=document.querySelectorAll(".shipPiece"),e=document.querySelectorAll(".userSquare"),n=[];let i;function r(t){const e=t.target,n="horizontal"===e.dataset.orientation?"vertical":"horizontal";e.dataset.orientation=n,e.style.transform="vertical"===n?"rotate(90deg)":"none"}function a(t){i=t.target,t.dataTransfer.setData("text/plain","")}function s(t){console.log(t.target),console.log("targetAbove")}function o(t){t.preventDefault()}function l(t){t.preventDefault();const e=t.target.closest(".userSquare");if(e){const r=t.clientX-e.getBoundingClientRect().left,a=t.clientY-e.getBoundingClientRect().top,s=Math.min(parseInt(e.dataset.row,10),9),o=Math.min(parseInt(e.dataset.column,10),9),l=parseInt(i.getAttribute("alt"),10),u=i.dataset.orientation;let c,d;"vertical"===u?(c=Math.min(s+Math.floor(a/e.offsetHeight),9-l+1),d=o):(c=s,d=Math.min(o+Math.floor(r/e.offsetWidth),9-l+1));const f=[];for(let t=0;t<l;t++){let e,n;if("vertical"===u?(e=c+t,n=d):(e=c,n=d+t),e>9||n>9)return void console.log("Invalid placement! Occupied squares extend beyond the boundary.");f.push({row:e,column:n})}if(console.log("Ship placed on User Squares:",f),"vertical"===u){i.style.transform="none",i.style.position="absolute",i.style.left="0",i.style.top="0",e.offsetWidth,i.offsetWidth;const t=0,n=0;i.style.left=e.offsetLeft+t+"px",i.style.top=e.offsetTop+n+"px"}e.appendChild(i),n.push({size:l,orientation:u,occupiedSquares:f}),console.log("Occupied Squares:",n)}}t.forEach((t=>{t.addEventListener("dragstart",a),t.addEventListener("dragend",s),t.addEventListener("click",r)})),e.forEach((t=>{t.addEventListener("dragover",o),t.addEventListener("drop",l)}))}()})();